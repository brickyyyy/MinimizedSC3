---
title: "SC3min on sc-ATAC-seq data"
output:
  html_document: default
  pdf_document: default
---

```{r knitr_init, echo=FALSE, cache=FALSE}
library(knitr)
library(rmdformats)
## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```
Open pre-processed data from 
```{r}
#READ COUNT MATRIX FROM ALL CELLS
library(Matrix)
countMatrix = readMM("/home/valentina7337/Downloads/filtered.mtx")
#check what we have in there
dim(countMatrix)
```


```{r echo=TRUE, eval=TRUE,cache=FALSE,include=TRUE}
rows = read.table("/home/valentina7337/Downloads/rows.txt")
cols = read.table("/home/valentina7337/Downloads/cols.txt")
rows = as.character(rows[,1])
cols = as.character(cols[,1])
mat = as.matrix(countMatrix)
rownames(mat) = rows
colnames(mat) = cols
```
Work with part of matrix only
```{r echo=TRUE, eval=TRUE,cache=FALSE,include=TRUE}
mat = mat[,c(1:2000)]
```

Create a SingleCell Experiment object.
```{r}
library(SingleCellExperiment)
logs = log2(mat+1)
sce = SingleCellExperiment::SingleCellExperiment(assays=list(counts= mat, 
                                                             logcounts = as.matrix(logs)))
                                                 # colData = cols,
                                                 # rowData = rows)
# define feature names in feature_symbol column
rowData(sce)$feature_symbol <- rownames(sce)
rm(logs)
rm(mat)
rm(countMatrix)
```

Estimate number of clusters (k) for sc3Min on the scATAC-seq data.
```{r include=FALSE}
# library(SC3min)
# sce = sc3min_estimate_k(sce)
# str(metadata(sce)$sc3)
```
Run sc3min on the sc-ATAC data with 12 ks.
```{r}
library(SC3min)
sce = sc3min(sce, ks=12)
```
Plot result of consensus. 
```{r}
library(SC3min)
sc3min_plot_consensus(sce, k = 12)
```

```{r include=FALSE}
#save(sce,file="scATAC2000.RData")
```
Inspect the diagonality of the matrix with Silhouette plot. The values range from 0 to 1, 1 being that there is a perfect block-diagonal consensus matrix. The best clustering is achieved when the average silhouette width is close to 1. 
```{r}
library(SC3min)
sc3min_plot_silhouette(sce, k = 12)

```